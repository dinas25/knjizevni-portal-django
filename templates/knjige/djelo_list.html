{% extends 'base.html' %}

{% block title %}Popis djela{% endblock %}

{% block content %}
<div class="card">
    <h2 style="margin-top:0; color: #222;">Popis svih djela</h2>
    
    <div class="search-box">
        <form method="get" id="search-form">
            <input 
                type="text" 
                name="q" 
                id="search-input"
                placeholder="Pretraži po naslovu..." 
                value="{{ request.GET.q|default:'' }}"
                autocomplete="off"
                style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px;"
            >
        </form>
    </div>

    <div id="results-container" class="list-container">
        {% if djela %}
            {% for djelo in djela %}
                <a href="{% url 'djelo-detail' djelo.id %}" class="item-link">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span class="naslov-tekst" style="display: block; font-size: 1.1rem; color: #333;">{{ djelo.naslov }}</span>
                            <span style="font-size: 0.9rem; color: #777;">Autor: {{ djelo.autor.ime }} {{ djelo.autor.prezime }}</span>
                        </div>
                        <span class="godina-tekst" style="color: #bbb;">{{ djelo.godina_izdanja }}. g.</span>
                    </div>
                </a>
            {% endfor %}
        {% else %}
            <p style="color: #999; padding: 20px;">Nema rezultata za vašu pretragu.</p>
        {% endif %}
    </div>
</div>

<script>
    const searchInput = document.getElementById('search-input');
    const form = document.getElementById('search-form');

    searchInput.addEventListener('input', function() {
        clearTimeout(this.delay);
        this.delay = setTimeout(function() {
            sessionStorage.setItem('isSearchingDjela', 'true');
            form.submit();
        }, 400);
    });

    window.onload = function() {
        if (sessionStorage.getItem('isSearchingDjela') === 'true') {
            searchInput.focus();
            const val = searchInput.value;
            searchInput.value = '';
            searchInput.value = val;
            sessionStorage.removeItem('isSearchingDjela');
        }
    };
</script>
{% endblock %}